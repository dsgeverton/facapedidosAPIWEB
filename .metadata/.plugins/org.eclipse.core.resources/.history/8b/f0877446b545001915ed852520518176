package br.com.codever.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;
import br.com.codever.model.Carrinho;
import br.com.codever.repository.CarrinhoRepository;
import nz.net.ultraq.thymeleaf.LayoutDialect;

@Controller
@RequestMapping("/carrinhos")
public class CarrinhoController {

		@Autowired
		private CarrinhoRepository carrinhoRepository;

		@RequestMapping("")
		public ModelAndView listarCarrinhos() {
			ModelAndView mv = new ModelAndView("ListaCarrinhos");
			mv.addObject(new Carrinho());
			mv.addObject("carrinhos", carrinhoRepository.findAll());
			return (mv);
		}

		@PostMapping
		public String salvarCarrinho(Carrinho carrinho) {
			this.carrinhoRepository.save(carrinho);
			return "redirect:/carrinhos";
		}

		@RequestMapping(value ="/excluir/{id}")
		public String excluirCarrinhoByPathVariable(@PathVariable Long id, HttpServletRequest request, HttpServletResponse response)
		{
			this.carrinhoRepository.deleteById(id);
			return "redirect:/carrinhos";
		}
		
		@RequestMapping(value ="/alterar/{id}")
		public ModelAndView alterarCarrinhoByPathVariable(@PathVariable Long id, HttpServletRequest request, HttpServletResponse response)
		{
			ModelAndView mv = new ModelAndView("ListaFestas");
			Carrinho carrinho = carrinhoRepository.getOne(id);
			mv.addObject(carrinho);
			mv.addObject("carrinhos", carrinhoRepository.findAll());
			return (mv);
		}
		
		@Bean
		public LayoutDialect layoutDialect() {
		    return new LayoutDialect();
		}
}
